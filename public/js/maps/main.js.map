{"version":3,"sources":["main.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","window","kan","palette","currentColor","numPaths","paths","paper","install","util","$","document","ready","initControlPanel","initColorPalette","initCanvasDraw","initNew","initUndo","initPlay","initTips","initShare","$paletteWrap","$paletteColors","find","paletteColorSize","paletteSelectedColorSize","paletteSelectedClass","on","$svg","this","hasClass","removeClass","attr","addClass","panStart","event","project","activeLayer","removeChildren","sizes","gesture","changedPointers","console","log","pointer","center","point","Point","x","y","path","CompoundPath","children","Path","name","strokeColor","fillColor","add","visible","panMove","preventDefault","memory","shift","bottomX","bottomY","bottom","topX","topY","top","p0","angle","dist","size","past","delta","alpha","threshold","cumSize","j","avgSize","Math","round","atan2","cos","PI","sin","insert","smooth","view","draw","push","panEnd","elasticity","group","Group","closed","simplify","lastChild","tap","hitResult","hitTest","hitOptions","item","id","selected","setup","$canvas","segments","stroke","fill","tolerance","hammer","data","get","set","direction","Hammer","DIRECTION_ALL","newPressed","undoPressed","playPressed","tipsPressed","sharePressed","main","./util","2","rad","degrees","deg","radians","p1","p2","sqrt","pow","findInteriorCurves","interiorCurves","child","interior","strokeBounds","isInside","remove","newPath","_i","unite","getInteriorPaths","Object","defineProperty","value"],"mappings":"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","file":"../main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\nwindow.kan = window.kan || {\n  palette: [\"#20171C\", \"#1E2A43\", \"#28377D\", \"#352747\", \"#F285A5\", \"#CA2E26\", \"#B84526\", \"#DA6C26\", \"#453121\", \"#916A47\", \"#EEB641\", \"#F6EB16\", \"#7F7D31\", \"#6EAD79\", \"#2A4621\", \"#F4EAE0\"],\n  currentColor: '#20171C',\n  numPaths: 10,\n  paths: []\n};\n\npaper.install(window);\n\nvar util = require('./util');\n\n$(document).ready(function () {\n  var MOVES = []; // store global moves list\n  // moves = [\n  //   {\n  //     'type': 'colorChange',\n  //     'old': '#20171C',\n  //     'new': '#F285A5'\n  //   },\n  //   {\n  //     'type': 'newPath',\n  //     'ref': '???' // uuid? dom reference?\n  //   },\n  //   {\n  //     'type': 'pathTransform',\n  //     'ref': '???', // uuid? dom reference?\n  //     'old': 'rotate(90deg)scale(1.5)', // ???\n  //     'new': 'rotate(120deg)scale(-0.5)' // ???\n  //   },\n  //   // others?\n  // ]\n\n  var $window = $(window);\n  var $body = $('body');\n  var $canvas = $('canvas#mainCanvas');\n\n  function initControlPanel() {\n    initColorPalette();\n    initCanvasDraw();\n    initNew();\n    initUndo();\n    initPlay();\n    initTips();\n    initShare();\n  }\n\n  function initColorPalette() {\n    var $paletteWrap = $('ul.palette-colors');\n    var $paletteColors = $paletteWrap.find('li');\n    var paletteColorSize = 20;\n    var paletteSelectedColorSize = 30;\n    var paletteSelectedClass = 'palette-selected';\n\n    // hook up click\n    $paletteColors.on('click tap touch', function () {\n      var $svg = $(this).find('svg.palette-color');\n\n      if (!$svg.hasClass(paletteSelectedClass)) {\n        $('.' + paletteSelectedClass).removeClass(paletteSelectedClass).attr('width', paletteColorSize).attr('height', paletteColorSize).find('rect').attr('rx', 0).attr('ry', 0);\n\n        $svg.addClass(paletteSelectedClass).attr('width', paletteSelectedColorSize).attr('height', paletteSelectedColorSize).find('rect').attr('rx', paletteSelectedColorSize / 2).attr('ry', paletteSelectedColorSize / 2);\n\n        window.kan.currentColor = $svg.find('rect').attr('fill');\n      }\n    });\n  }\n\n  function initCanvasDraw() {\n\n    paper.setup($canvas[0]);\n\n    var path = void 0;\n    var past = void 0;\n    var pasts = [];\n    var sizes = void 0;\n    // let paths = getFreshPaths(window.kan.numPaths);\n    var touch = false;\n    var lastChild = void 0;\n\n    function panStart(event) {\n      paper.project.activeLayer.removeChildren(); // REMOVE\n\n      sizes = [];\n\n      if (!(event.gesture.changedPointers && event.gesture.changedPointers.length > 0)) return;\n      if (event.gesture.changedPointers.length > 1) {\n        console.log('event.gesture.changedPointers > 1');\n      }\n\n      var pointer = event.gesture.center;\n      var point = new Point(pointer.x, pointer.y);\n\n      // the first path is what is actually drawn, the second path keeps track of center points\n      path = new CompoundPath({\n        children: [new Path({\n          name: 'bounds'\n        }), new Path({\n          name: 'middle'\n        })],\n        strokeColor: window.kan.currentColor,\n        fillColor: window.kan.currentColor\n      });\n\n      path.children['bounds'].add(point);\n\n      path.children['middle'].add(point);\n      path.children['middle'].visible = false; // second path is only for internal use, hide it\n    }\n\n    var threshold = 20;\n    var alpha = 0.3;\n    var memory = 10;\n    var cumSize = void 0,\n        avgSize = void 0;\n    function panMove(event) {\n      event.preventDefault();\n\n      var pointer = event.gesture.center;\n      var point = new Point(pointer.x, pointer.y);\n\n      while (sizes.length > memory) {\n        sizes.shift();\n      }\n\n      var bottomX = void 0,\n          bottomY = void 0,\n          bottom = void 0,\n          topX = void 0,\n          topY = void 0,\n          top = void 0,\n          p0 = void 0,\n          p1 = void 0,\n          step = void 0,\n          angle = void 0,\n          dist = void 0,\n          size = void 0;\n\n      if (sizes.length > 0) {\n        // not the first point, so we have others to compare to\n        p0 = past;\n        dist = util.delta(point, p0);\n        size = dist * alpha;\n        if (size >= threshold) size = threshold;\n\n        cumSize = 0;\n        for (var j = 0; j < sizes.length; j++) {\n          cumSize += sizes[j];\n        }\n        avgSize = Math.round((cumSize / sizes.length + size) / 2);\n        // console.log(avgSize);\n\n        angle = Math.atan2(point.y - p0.y, point.x - p0.x); // rad\n\n        // Point(bottomX, bottomY) is bottom, Point(topX, topY) is top\n        bottomX = point.x + Math.cos(angle + Math.PI / 2) * avgSize;\n        bottomY = point.y + Math.sin(angle + Math.PI / 2) * avgSize;\n        bottom = new Point(bottomX, bottomY);\n\n        topX = point.x + Math.cos(angle - Math.PI / 2) * avgSize;\n        topY = point.y + Math.sin(angle - Math.PI / 2) * avgSize;\n        top = new Point(topX, topY);\n\n        path.children['bounds'].add(top);\n        path.children['bounds'].insert(0, bottom);\n        path.children['bounds'].smooth();\n\n        path.children['middle'].add(point);\n      } else {\n        // don't have anything to compare to\n        dist = 1;\n        angle = 0;\n\n        size = dist * alpha;\n        if (size >= threshold) size = threshold;\n      }\n\n      paper.view.draw();\n\n      past = point;\n      sizes.push(size);\n    }\n\n    function panEnd(event) {\n      elasticity = 1;\n\n      var pointer = event.gesture.center;\n      var point = new Point(pointer.x, pointer.y);\n\n      var group = new Group(path);\n\n      path.children['middle'].add(point);\n      path.children['middle'].smooth();\n      // path.children['middle'].simplify(0);\n      path.children['middle'].closed = false;\n      path.children['middle'].visible = false;\n\n      path.children['bounds'].add(point);\n      path.children['bounds'].smooth();\n      path.children['bounds'].simplify(0);\n      path.children['bounds'].closed = true;\n      // let intersections = path.children['bounds'].getCrossings();\n      // if (intersections.length > 0) {\n      //   path.children['bounds'].resolveCrossings(); // destroys path.children['bounds']\n      //   let enclosedLoops = util.findInteriorCurves(path);\n      //   console.log('enclosedLoops', enclosedLoops);\n      //   if (enclosedLoops) {\n      //     for (let i = 0; i < enclosedLoops.length; i++) {\n      //       console.log('enclosedLoops[i]', enclosedLoops[i]);\n      //       group.addChild(enclosedLoops[i]);\n      //     }\n      //   }\n      // } else {\n      //   console.log('no intersections');\n      // }\n      //\n      // console.log('group', group);\n\n      lastChild = group;\n    }\n\n    var hitOptions = {\n      segments: false,\n      stroke: true,\n      fill: true,\n      tolerance: 5\n    };\n\n    function tap(event) {\n      var pointer = event.gesture.center,\n          point = new Point(pointer.x, pointer.y),\n          hitResult = paper.project.hitTest(point, hitOptions);\n\n      if (hitResult) {\n        var item = hitResult.item;\n\n        console.log(item.id, item);\n        item.selected = !item.selected;\n\n        // item.visible = true;\n        // console.log(item);\n        // console.log('fillColor before: ', item.fillColor);\n        // item.fillColor = item.strokeColor;\n        // console.log('fillColor after: ', item.fillColor);\n        // if (item.hasFill()) {\n        //   console.log('item has fill');\n        // } else {\n        //   console.log('no fill');\n        // }\n      }\n    }\n\n    // var animationId;\n    var elasticity = 0;\n\n    function jiggle(event) {\n\n      // console.log(paper.project.activeLayer.firstChild);\n      // paper.project.activeLayer.firstChild.rotate(3);\n      if (!!lastChild) {\n        if (elasticity > 0) {\n          // console.log(lastChild);\n          for (var i = 0; i < lastChild.segments.length; i++) {\n            var segment = lastChild.segments[i];\n            var timeConst = 16;\n            var divConst = 2;\n            var cos = Math.cos(event.time * timeConst + i);\n            var sin = Math.sin(event.time * timeConst + i);\n            segment.point.x += cos / divConst * elasticity;\n            segment.point.y += sin / divConst * elasticity;\n            // console.log(cos, sin, elasticity);\n            elasticity -= 0.001;\n          }\n        }\n      } else {\n        // console.log('no children yet');\n      }\n    }\n\n    // paper.view.onFrame = jiggle;\n\n    $canvas.hammer().on('panstart', panStart).on('panmove', panMove).on('panend', panEnd).on('tap', tap);\n\n    $canvas.data('hammer').get('pan').set({ direction: Hammer.DIRECTION_ALL });\n  }\n\n  function newPressed() {\n    console.log('new pressed');\n\n    paper.project.activeLayer.removeChildren();\n  }\n\n  function undoPressed() {\n    console.log('undo pressed');\n    // d3.selectAll('svg.main path:last-child').remove();\n  }\n\n  function playPressed() {\n    console.log('play pressed');\n  }\n\n  function tipsPressed() {\n    console.log('tips pressed');\n  }\n\n  function sharePressed() {\n    console.log('share pressed');\n  }\n\n  function initNew() {\n    $('.main-controls .new').on('click tap touch', newPressed);\n  }\n\n  function initUndo() {\n    $('.main-controls .undo').on('click', undoPressed);\n  }\n  function initPlay() {\n    $('.main-controls .play').on('click', playPressed);\n  }\n  function initTips() {\n    $('.aux-controls .tips').on('click', tipsPressed);\n  }\n  function initShare() {\n    $('.aux-controls .share').on('click', sharePressed);\n  }\n\n  function main() {\n    initControlPanel();\n  }\n\n  main();\n});\n\n},{\"./util\":2}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.rad = rad;\nexports.deg = deg;\nexports.delta = delta;\nexports.findInteriorCurves = findInteriorCurves;\nexports.getInteriorPaths = getInteriorPaths;\n// Converts from degrees to radians.\nfunction rad(degrees) {\n  return degrees * Math.PI / 180;\n};\n\n// Converts from radians to degrees.\nfunction deg(radians) {\n  return radians * 180 / Math.PI;\n};\n\nfunction delta(p1, p2) {\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2)); // pythagorean!\n}\n\nfunction findInteriorCurves(path) {\n  var interiorCurves = [];\n\n  for (var i = 0; i < path.children.length; i++) {\n    var child = path.children[i];\n\n    if (!child.closed) {\n      child.remove();\n    } else {\n      var bounds = child.strokeBounds;\n      var interior = false;\n\n      // iterate through all other children to see if this child is entirely within another. if so, it is an interior path\n      for (var j = 0; j < path.children.length; j++) {\n        // don't test against itself\n        if (j !== i) {\n          if (child.isInside(path.children[j].strokeBounds)) {\n            interior = true;\n          }\n        }\n      }\n\n      if (interior) {\n        interiorCurves.push(new Path(child.segments));\n      }\n    }\n  }\n\n  var newPath = new Path({\n    fillColor: 'pink',\n    strokeColor: 'pink'\n  });\n  for (var _i = 0; _i < path.children.length; _i++) {\n    // console.log(path.children[i]);\n    console.log(newPath.unite(path.children[_i]));\n  }\n\n  path.remove();\n\n  console.log('newPath', newPath);\n  console.log('path', path);\n\n  if (interiorCurves.length > 0) {\n    return interiorCurves;\n  } else {\n    return null;\n  }\n}\n\nfunction getInteriorPaths(path) {\n  // let intersections = path.getCrossings();\n  // for (let i = 0; i < intersections.length; i++) {\n  //   let intersection = intersections[i];\n  //   intersection.path.resolveCrossings();\n  // }\n  // path.visible = false;\n  // let secondaryPath = path.clone();\n  // secondaryPath.visible = false;\n  // secondaryPath.resolveCrossings();\n  // let oldPath = path;\n  // console.log(oldPath);\n  // path.resolveCrossings();\n  // console.log(path);\n  // console.log(path == oldPath);\n  return null;\n}\n\n// export function getInteriorPaths(path) {\n//   if (!path || !path.segments || !(path.segments.length > 0)) return null;\n//\n//   let intersections = path.getCrossings();\n//   // console.log('length', intersections.length);\n//   if (intersections && intersections.length > 0) {\n//     for (let i = 0; i < intersections.length; i++) {\n//       console.log('----------------');\n//       let intersection = intersections[i];\n//       let location = path.getLocationOf(intersection.point);\n//       console.log('location', location.toString());\n//       let index = location.curve.index;\n//       console.log('index', index.toString());\n//       let lastAngle;\n//       var intersectionPath;\n//       let interior = false;\n//       console.log('path', path.toString());\n//       console.log('intersection', intersection.toString());\n//       for (let j = 0; j < path.segments.length; j++) {\n//         let point = path.segments[j].point;\n//         let angle = intersection.point.getDirectedAngle(point);\n//\n//         if (lastAngle) {\n//           // ignore the first point, since there's no previous angle to compare to\n//           if ((angle * lastAngle) < 0) {\n//             console.log('cross');\n//\n//             // product of angle and lastAngle will only be negative if one is positive and the other is negative\n//             if (!interior) {\n//               interior = true;\n//               var intersectionPath = new Path({\n//                 strokeColor: window.kan.currentColor,\n//                 fillColor: window.kan.currentColor\n//               });\n//               intersectionPath.add(intersection.point);\n//             } else {\n//               interior = false;\n//               // intersectionPath.add(intersection.point);\n//               // intersectionPath.closed = false;\n//               intersectionPath.smooth();\n//               intersectionPath.selected = true;\n//               // break;\n//               // break;\n//             }\n//           }\n//         }\n//\n//         if (interior) {\n//           intersectionPath.add(point);\n//           new Path.Circle({\n//             center: point,\n//             radius: 3,\n//             fillColor: 'pink'\n//           });\n//         }\n//\n//         lastAngle = angle;\n//         // if (closest) {\n//         //   if (distance < closest) {\n//         //     closest = distance;\n//         //   }\n//         //   // console.log(distance);\n//         //   // if (distance > lastDistance) {\n//         //   //   console.log('colder');\n//         //   // } else if (distance < lastDistance){\n//         //   //   console.log('warmer');\n//         //   // } else {\n//         //   //   console.log('same');\n//         //   // }\n//         // } else {\n//         //   closest = distance;\n//         //   // first point, start new path\n//         //   // let intersectionPath = new Path({\n//         //   //   strokeColor: window.kan.currentColor,\n//         //   //   fillColor: window.kan.currentColor\n//         //   // });\n//         //   // intersectionPath.add(intersection.point);\n//         //\n//         // }\n//\n//         // new Path.Circle({\n//         //   center: point,\n//         //   radius: 3,\n//         //   fillColor: 'pink'\n//         // });\n//       }\n//     }\n//   } else {\n//     return null;\n//   }\n// }\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy91dGlsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxPQUFPLEdBQVAsR0FBYSxPQUFPLEdBQVAsSUFBYztBQUN6QixXQUFTLENBQUMsU0FBRCxFQUFZLFNBQVosRUFBdUIsU0FBdkIsRUFBa0MsU0FBbEMsRUFBNkMsU0FBN0MsRUFBd0QsU0FBeEQsRUFBbUUsU0FBbkUsRUFBOEUsU0FBOUUsRUFBeUYsU0FBekYsRUFBb0csU0FBcEcsRUFBK0csU0FBL0csRUFBMEgsU0FBMUgsRUFBcUksU0FBckksRUFBZ0osU0FBaEosRUFBMkosU0FBM0osRUFBc0ssU0FBdEssQ0FEZ0I7QUFFekIsZ0JBQWMsU0FGVztBQUd6QixZQUFVLEVBSGU7QUFJekIsU0FBTztBQUprQixDQUEzQjs7QUFPQSxNQUFNLE9BQU4sQ0FBYyxNQUFkOztBQUVBLElBQU0sT0FBTyxRQUFRLFFBQVIsQ0FBYjs7QUFFQSxFQUFFLFFBQUYsRUFBWSxLQUFaLENBQWtCLFlBQVc7QUFDM0IsTUFBSSxRQUFRLEVBQVosQ0FEMkIsQ0FDWDtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTSxVQUFVLEVBQUUsTUFBRixDQUFoQjtBQUNBLE1BQU0sUUFBUSxFQUFFLE1BQUYsQ0FBZDtBQUNBLE1BQU0sVUFBVSxFQUFFLG1CQUFGLENBQWhCOztBQUVBLFdBQVMsZ0JBQVQsR0FBNEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDRDs7QUFFRCxXQUFTLGdCQUFULEdBQTRCO0FBQzFCLFFBQU0sZUFBZSxFQUFFLG1CQUFGLENBQXJCO0FBQ0EsUUFBTSxpQkFBaUIsYUFBYSxJQUFiLENBQWtCLElBQWxCLENBQXZC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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIndpbmRvdy5rYW4gPSB3aW5kb3cua2FuIHx8IHtcbiAgcGFsZXR0ZTogW1wiIzIwMTcxQ1wiLCBcIiMxRTJBNDNcIiwgXCIjMjgzNzdEXCIsIFwiIzM1Mjc0N1wiLCBcIiNGMjg1QTVcIiwgXCIjQ0EyRTI2XCIsIFwiI0I4NDUyNlwiLCBcIiNEQTZDMjZcIiwgXCIjNDUzMTIxXCIsIFwiIzkxNkE0N1wiLCBcIiNFRUI2NDFcIiwgXCIjRjZFQjE2XCIsIFwiIzdGN0QzMVwiLCBcIiM2RUFENzlcIiwgXCIjMkE0NjIxXCIsIFwiI0Y0RUFFMFwiXSxcbiAgY3VycmVudENvbG9yOiAnIzIwMTcxQycsXG4gIG51bVBhdGhzOiAxMCxcbiAgcGF0aHM6IFtdLFxufTtcblxucGFwZXIuaW5zdGFsbCh3aW5kb3cpO1xuXG5jb25zdCB1dGlsID0gcmVxdWlyZSgnLi91dGlsJyk7XG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICBsZXQgTU9WRVMgPSBbXTsgLy8gc3RvcmUgZ2xvYmFsIG1vdmVzIGxpc3RcbiAgLy8gbW92ZXMgPSBbXG4gIC8vICAge1xuICAvLyAgICAgJ3R5cGUnOiAnY29sb3JDaGFuZ2UnLFxuICAvLyAgICAgJ29sZCc6ICcjMjAxNzFDJyxcbiAgLy8gICAgICduZXcnOiAnI0YyODVBNSdcbiAgLy8gICB9LFxuICAvLyAgIHtcbiAgLy8gICAgICd0eXBlJzogJ25ld1BhdGgnLFxuICAvLyAgICAgJ3JlZic6ICc/Pz8nIC8vIHV1aWQ/IGRvbSByZWZlcmVuY2U/XG4gIC8vICAgfSxcbiAgLy8gICB7XG4gIC8vICAgICAndHlwZSc6ICdwYXRoVHJhbnNmb3JtJyxcbiAgLy8gICAgICdyZWYnOiAnPz8/JywgLy8gdXVpZD8gZG9tIHJlZmVyZW5jZT9cbiAgLy8gICAgICdvbGQnOiAncm90YXRlKDkwZGVnKXNjYWxlKDEuNSknLCAvLyA/Pz9cbiAgLy8gICAgICduZXcnOiAncm90YXRlKDEyMGRlZylzY2FsZSgtMC41KScgLy8gPz8/XG4gIC8vICAgfSxcbiAgLy8gICAvLyBvdGhlcnM/XG4gIC8vIF1cblxuICBjb25zdCAkd2luZG93ID0gJCh3aW5kb3cpO1xuICBjb25zdCAkYm9keSA9ICQoJ2JvZHknKTtcbiAgY29uc3QgJGNhbnZhcyA9ICQoJ2NhbnZhcyNtYWluQ2FudmFzJyk7XG5cbiAgZnVuY3Rpb24gaW5pdENvbnRyb2xQYW5lbCgpIHtcbiAgICBpbml0Q29sb3JQYWxldHRlKCk7XG4gICAgaW5pdENhbnZhc0RyYXcoKTtcbiAgICBpbml0TmV3KCk7XG4gICAgaW5pdFVuZG8oKTtcbiAgICBpbml0UGxheSgpO1xuICAgIGluaXRUaXBzKCk7XG4gICAgaW5pdFNoYXJlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBpbml0Q29sb3JQYWxldHRlKCkge1xuICAgIGNvbnN0ICRwYWxldHRlV3JhcCA9ICQoJ3VsLnBhbGV0dGUtY29sb3JzJyk7XG4gICAgY29uc3QgJHBhbGV0dGVDb2xvcnMgPSAkcGFsZXR0ZVdyYXAuZmluZCgnbGknKTtcbiAgICBjb25zdCBwYWxldHRlQ29sb3JTaXplID0gMjA7XG4gICAgY29uc3QgcGFsZXR0ZVNlbGVjdGVkQ29sb3JTaXplID0gMzA7XG4gICAgY29uc3QgcGFsZXR0ZVNlbGVjdGVkQ2xhc3MgPSAncGFsZXR0ZS1zZWxlY3RlZCc7XG5cbiAgICAvLyBob29rIHVwIGNsaWNrXG4gICAgICAkcGFsZXR0ZUNvbG9ycy5vbignY2xpY2sgdGFwIHRvdWNoJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbGV0ICRzdmcgPSAkKHRoaXMpLmZpbmQoJ3N2Zy5wYWxldHRlLWNvbG9yJyk7XG5cbiAgICAgICAgICBpZiAoISRzdmcuaGFzQ2xhc3MocGFsZXR0ZVNlbGVjdGVkQ2xhc3MpKSB7XG4gICAgICAgICAgICAkKCcuJyArIHBhbGV0dGVTZWxlY3RlZENsYXNzKVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MocGFsZXR0ZVNlbGVjdGVkQ2xhc3MpXG4gICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHBhbGV0dGVDb2xvclNpemUpXG4gICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBwYWxldHRlQ29sb3JTaXplKVxuICAgICAgICAgICAgICAuZmluZCgncmVjdCcpXG4gICAgICAgICAgICAgIC5hdHRyKCdyeCcsIDApXG4gICAgICAgICAgICAgIC5hdHRyKCdyeScsIDApO1xuXG4gICAgICAgICAgICAkc3ZnLmFkZENsYXNzKHBhbGV0dGVTZWxlY3RlZENsYXNzKVxuICAgICAgICAgICAgICAuYXR0cignd2lkdGgnLCBwYWxldHRlU2VsZWN0ZWRDb2xvclNpemUpXG4gICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBwYWxldHRlU2VsZWN0ZWRDb2xvclNpemUpXG4gICAgICAgICAgICAgIC5maW5kKCdyZWN0JylcbiAgICAgICAgICAgICAgLmF0dHIoJ3J4JywgcGFsZXR0ZVNlbGVjdGVkQ29sb3JTaXplIC8gMilcbiAgICAgICAgICAgICAgLmF0dHIoJ3J5JywgcGFsZXR0ZVNlbGVjdGVkQ29sb3JTaXplIC8gMilcblxuICAgICAgICAgICAgd2luZG93Lmthbi5jdXJyZW50Q29sb3IgPSAkc3ZnLmZpbmQoJ3JlY3QnKS5hdHRyKCdmaWxsJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluaXRDYW52YXNEcmF3KCkge1xuXG4gICAgcGFwZXIuc2V0dXAoJGNhbnZhc1swXSk7XG5cbiAgICBsZXQgcGF0aDtcbiAgICBsZXQgcGFzdDtcbiAgICBsZXQgcGFzdHMgPSBbXTtcbiAgICBsZXQgc2l6ZXM7XG4gICAgLy8gbGV0IHBhdGhzID0gZ2V0RnJlc2hQYXRocyh3aW5kb3cua2FuLm51bVBhdGhzKTtcbiAgICBsZXQgdG91Y2ggPSBmYWxzZTtcbiAgICBsZXQgbGFzdENoaWxkO1xuXG4gICAgZnVuY3Rpb24gcGFuU3RhcnQoZXZlbnQpIHtcbiAgICAgIHBhcGVyLnByb2plY3QuYWN0aXZlTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTsgLy8gUkVNT1ZFXG5cbiAgICAgIHNpemVzID0gW107XG5cbiAgICAgIGlmICghKGV2ZW50Lmdlc3R1cmUuY2hhbmdlZFBvaW50ZXJzICYmIGV2ZW50Lmdlc3R1cmUuY2hhbmdlZFBvaW50ZXJzLmxlbmd0aCA+IDApKSByZXR1cm47XG4gICAgICBpZiAoZXZlbnQuZ2VzdHVyZS5jaGFuZ2VkUG9pbnRlcnMubGVuZ3RoID4gMSkge1xuICAgICAgICBjb25zb2xlLmxvZygnZXZlbnQuZ2VzdHVyZS5jaGFuZ2VkUG9pbnRlcnMgPiAxJyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBvaW50ZXIgPSBldmVudC5nZXN0dXJlLmNlbnRlcjtcbiAgICAgIGNvbnN0IHBvaW50ID0gbmV3IFBvaW50KHBvaW50ZXIueCwgcG9pbnRlci55KTtcblxuICAgICAgLy8gdGhlIGZpcnN0IHBhdGggaXMgd2hhdCBpcyBhY3R1YWxseSBkcmF3biwgdGhlIHNlY29uZCBwYXRoIGtlZXBzIHRyYWNrIG9mIGNlbnRlciBwb2ludHNcbiAgICAgIHBhdGggPSBuZXcgQ29tcG91bmRQYXRoKHtcbiAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICBuZXcgUGF0aCh7XG4gICAgICAgICAgICBuYW1lOiAnYm91bmRzJ1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIG5ldyBQYXRoKHtcbiAgICAgICAgICAgIG5hbWU6ICdtaWRkbGUnXG4gICAgICAgICAgfSlcbiAgICAgICAgXSxcbiAgICAgICAgc3Ryb2tlQ29sb3I6IHdpbmRvdy5rYW4uY3VycmVudENvbG9yLFxuICAgICAgICBmaWxsQ29sb3I6IHdpbmRvdy5rYW4uY3VycmVudENvbG9yXG4gICAgICB9KTtcblxuICAgICAgcGF0aC5jaGlsZHJlblsnYm91bmRzJ10uYWRkKHBvaW50KTtcblxuICAgICAgcGF0aC5jaGlsZHJlblsnbWlkZGxlJ10uYWRkKHBvaW50KTtcbiAgICAgIHBhdGguY2hpbGRyZW5bJ21pZGRsZSddLnZpc2libGUgPSBmYWxzZTsgLy8gc2Vjb25kIHBhdGggaXMgb25seSBmb3IgaW50ZXJuYWwgdXNlLCBoaWRlIGl0XG4gICAgfVxuXG4gICAgY29uc3QgdGhyZXNob2xkID0gMjA7XG4gICAgY29uc3QgYWxwaGEgPSAwLjM7XG4gICAgY29uc3QgbWVtb3J5ID0gMTA7XG4gICAgbGV0IGN1bVNpemUsIGF2Z1NpemU7XG4gICAgZnVuY3Rpb24gcGFuTW92ZShldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgY29uc3QgcG9pbnRlciA9IGV2ZW50Lmdlc3R1cmUuY2VudGVyO1xuICAgICAgY29uc3QgcG9pbnQgPSBuZXcgUG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpO1xuXG4gICAgICB3aGlsZSAoc2l6ZXMubGVuZ3RoID4gbWVtb3J5KSB7XG4gICAgICAgIHNpemVzLnNoaWZ0KCk7XG4gICAgICB9XG5cbiAgICAgIGxldCBib3R0b21YLCBib3R0b21ZLCBib3R0b20sXG4gICAgICAgIHRvcFgsIHRvcFksIHRvcCxcbiAgICAgICAgcDAsIHAxLFxuICAgICAgICBzdGVwLCBhbmdsZSwgZGlzdCwgc2l6ZTtcblxuICAgICAgaWYgKHNpemVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gbm90IHRoZSBmaXJzdCBwb2ludCwgc28gd2UgaGF2ZSBvdGhlcnMgdG8gY29tcGFyZSB0b1xuICAgICAgICBwMCA9IHBhc3Q7XG4gICAgICAgIGRpc3QgPSB1dGlsLmRlbHRhKHBvaW50LCBwMCk7XG4gICAgICAgIHNpemUgPSBkaXN0ICogYWxwaGE7XG4gICAgICAgIGlmIChzaXplID49IHRocmVzaG9sZCkgc2l6ZSA9IHRocmVzaG9sZDtcblxuICAgICAgICBjdW1TaXplID0gMDtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaXplcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgIGN1bVNpemUgKz0gc2l6ZXNbal07XG4gICAgICAgIH1cbiAgICAgICAgYXZnU2l6ZSA9IE1hdGgucm91bmQoKChjdW1TaXplIC8gc2l6ZXMubGVuZ3RoKSArIHNpemUpIC8gMik7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGF2Z1NpemUpO1xuXG4gICAgICAgIGFuZ2xlID0gTWF0aC5hdGFuMihwb2ludC55IC0gcDAueSwgcG9pbnQueCAtIHAwLngpOyAvLyByYWRcblxuICAgICAgICAvLyBQb2ludChib3R0b21YLCBib3R0b21ZKSBpcyBib3R0b20sIFBvaW50KHRvcFgsIHRvcFkpIGlzIHRvcFxuICAgICAgICBib3R0b21YID0gcG9pbnQueCArIE1hdGguY29zKGFuZ2xlICsgTWF0aC5QSS8yKSAqIGF2Z1NpemU7XG4gICAgICAgIGJvdHRvbVkgPSBwb2ludC55ICsgTWF0aC5zaW4oYW5nbGUgKyBNYXRoLlBJLzIpICogYXZnU2l6ZTtcbiAgICAgICAgYm90dG9tID0gbmV3IFBvaW50KGJvdHRvbVgsIGJvdHRvbVkpO1xuXG4gICAgICAgIHRvcFggPSBwb2ludC54ICsgTWF0aC5jb3MoYW5nbGUgLSBNYXRoLlBJLzIpICogYXZnU2l6ZTtcbiAgICAgICAgdG9wWSA9IHBvaW50LnkgKyBNYXRoLnNpbihhbmdsZSAtIE1hdGguUEkvMikgKiBhdmdTaXplO1xuICAgICAgICB0b3AgPSBuZXcgUG9pbnQodG9wWCwgdG9wWSk7XG5cbiAgICAgICAgcGF0aC5jaGlsZHJlblsnYm91bmRzJ10uYWRkKHRvcCk7XG4gICAgICAgIHBhdGguY2hpbGRyZW5bJ2JvdW5kcyddLmluc2VydCgwLCBib3R0b20pO1xuICAgICAgICBwYXRoLmNoaWxkcmVuWydib3VuZHMnXS5zbW9vdGgoKTtcblxuICAgICAgICBwYXRoLmNoaWxkcmVuWydtaWRkbGUnXS5hZGQocG9pbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZG9uJ3QgaGF2ZSBhbnl0aGluZyB0byBjb21wYXJlIHRvXG4gICAgICAgIGRpc3QgPSAxO1xuICAgICAgICBhbmdsZSA9IDA7XG5cbiAgICAgICAgc2l6ZSA9IGRpc3QgKiBhbHBoYTtcbiAgICAgICAgaWYgKHNpemUgPj0gdGhyZXNob2xkKSBzaXplID0gdGhyZXNob2xkO1xuICAgICAgfVxuXG4gICAgICBwYXBlci52aWV3LmRyYXcoKTtcblxuICAgICAgcGFzdCA9IHBvaW50O1xuICAgICAgc2l6ZXMucHVzaChzaXplKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwYW5FbmQoZXZlbnQpIHtcbiAgICAgIGVsYXN0aWNpdHkgPSAxO1xuXG4gICAgICBjb25zdCBwb2ludGVyID0gZXZlbnQuZ2VzdHVyZS5jZW50ZXI7XG4gICAgICBjb25zdCBwb2ludCA9IG5ldyBQb2ludChwb2ludGVyLngsIHBvaW50ZXIueSk7XG5cbiAgICAgIGNvbnN0IGdyb3VwID0gbmV3IEdyb3VwKHBhdGgpO1xuXG4gICAgICBwYXRoLmNoaWxkcmVuWydtaWRkbGUnXS5hZGQocG9pbnQpO1xuICAgICAgcGF0aC5jaGlsZHJlblsnbWlkZGxlJ10uc21vb3RoKCk7XG4gICAgICAvLyBwYXRoLmNoaWxkcmVuWydtaWRkbGUnXS5zaW1wbGlmeSgwKTtcbiAgICAgIHBhdGguY2hpbGRyZW5bJ21pZGRsZSddLmNsb3NlZCA9IGZhbHNlO1xuICAgICAgcGF0aC5jaGlsZHJlblsnbWlkZGxlJ10udmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgICBwYXRoLmNoaWxkcmVuWydib3VuZHMnXS5hZGQocG9pbnQpO1xuICAgICAgcGF0aC5jaGlsZHJlblsnYm91bmRzJ10uc21vb3RoKCk7XG4gICAgICBwYXRoLmNoaWxkcmVuWydib3VuZHMnXS5zaW1wbGlmeSgwKTtcbiAgICAgIHBhdGguY2hpbGRyZW5bJ2JvdW5kcyddLmNsb3NlZCA9IHRydWU7XG4gICAgICAvLyBsZXQgaW50ZXJzZWN0aW9ucyA9IHBhdGguY2hpbGRyZW5bJ2JvdW5kcyddLmdldENyb3NzaW5ncygpO1xuICAgICAgLy8gaWYgKGludGVyc2VjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gICBwYXRoLmNoaWxkcmVuWydib3VuZHMnXS5yZXNvbHZlQ3Jvc3NpbmdzKCk7IC8vIGRlc3Ryb3lzIHBhdGguY2hpbGRyZW5bJ2JvdW5kcyddXG4gICAgICAvLyAgIGxldCBlbmNsb3NlZExvb3BzID0gdXRpbC5maW5kSW50ZXJpb3JDdXJ2ZXMocGF0aCk7XG4gICAgICAvLyAgIGNvbnNvbGUubG9nKCdlbmNsb3NlZExvb3BzJywgZW5jbG9zZWRMb29wcyk7XG4gICAgICAvLyAgIGlmIChlbmNsb3NlZExvb3BzKSB7XG4gICAgICAvLyAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbmNsb3NlZExvb3BzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAvLyAgICAgICBjb25zb2xlLmxvZygnZW5jbG9zZWRMb29wc1tpXScsIGVuY2xvc2VkTG9vcHNbaV0pO1xuICAgICAgLy8gICAgICAgZ3JvdXAuYWRkQ2hpbGQoZW5jbG9zZWRMb29wc1tpXSk7XG4gICAgICAvLyAgICAgfVxuICAgICAgLy8gICB9XG4gICAgICAvLyB9IGVsc2Uge1xuICAgICAgLy8gICBjb25zb2xlLmxvZygnbm8gaW50ZXJzZWN0aW9ucycpO1xuICAgICAgLy8gfVxuICAgICAgLy9cbiAgICAgIC8vIGNvbnNvbGUubG9nKCdncm91cCcsIGdyb3VwKTtcblxuICAgICAgbGFzdENoaWxkID0gZ3JvdXA7XG4gICAgfVxuXG4gICAgY29uc3QgaGl0T3B0aW9ucyA9IHtcbiAgICAgIHNlZ21lbnRzOiBmYWxzZSxcbiAgICAgIHN0cm9rZTogdHJ1ZSxcbiAgICAgIGZpbGw6IHRydWUsXG4gICAgICB0b2xlcmFuY2U6IDVcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gdGFwKGV2ZW50KSB7XG4gICAgICBjb25zdCBwb2ludGVyID0gZXZlbnQuZ2VzdHVyZS5jZW50ZXIsXG4gICAgICAgICAgcG9pbnQgPSBuZXcgUG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpLFxuICAgICAgICAgIGhpdFJlc3VsdCA9IHBhcGVyLnByb2plY3QuaGl0VGVzdChwb2ludCwgaGl0T3B0aW9ucyk7XG5cbiAgICAgIGlmIChoaXRSZXN1bHQpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSBoaXRSZXN1bHQuaXRlbTtcblxuICAgICAgICBjb25zb2xlLmxvZyhpdGVtLmlkLCBpdGVtKTtcbiAgICAgICAgaXRlbS5zZWxlY3RlZCA9ICFpdGVtLnNlbGVjdGVkO1xuXG4gICAgICAgIC8vIGl0ZW0udmlzaWJsZSA9IHRydWU7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGl0ZW0pO1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnZmlsbENvbG9yIGJlZm9yZTogJywgaXRlbS5maWxsQ29sb3IpO1xuICAgICAgICAvLyBpdGVtLmZpbGxDb2xvciA9IGl0ZW0uc3Ryb2tlQ29sb3I7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdmaWxsQ29sb3IgYWZ0ZXI6ICcsIGl0ZW0uZmlsbENvbG9yKTtcbiAgICAgICAgLy8gaWYgKGl0ZW0uaGFzRmlsbCgpKSB7XG4gICAgICAgIC8vICAgY29uc29sZS5sb2coJ2l0ZW0gaGFzIGZpbGwnKTtcbiAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgLy8gICBjb25zb2xlLmxvZygnbm8gZmlsbCcpO1xuICAgICAgICAvLyB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gdmFyIGFuaW1hdGlvbklkO1xuICAgIGxldCBlbGFzdGljaXR5ID0gMDtcblxuICAgIGZ1bmN0aW9uIGppZ2dsZShldmVudCkge1xuXG4gICAgICAvLyBjb25zb2xlLmxvZyhwYXBlci5wcm9qZWN0LmFjdGl2ZUxheWVyLmZpcnN0Q2hpbGQpO1xuICAgICAgLy8gcGFwZXIucHJvamVjdC5hY3RpdmVMYXllci5maXJzdENoaWxkLnJvdGF0ZSgzKTtcbiAgICAgIGlmICghIWxhc3RDaGlsZCkge1xuICAgICAgICBpZiAoZWxhc3RpY2l0eSA+IDApIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhsYXN0Q2hpbGQpO1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGFzdENoaWxkLnNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBzZWdtZW50ID0gbGFzdENoaWxkLnNlZ21lbnRzW2ldO1xuICAgICAgICAgICAgY29uc3QgdGltZUNvbnN0ID0gMTY7XG4gICAgICAgICAgICBjb25zdCBkaXZDb25zdCA9IDI7XG4gICAgICAgICAgICBjb25zdCBjb3MgPSBNYXRoLmNvcyhldmVudC50aW1lICogdGltZUNvbnN0ICsgaSk7XG4gICAgICAgICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbihldmVudC50aW1lICogdGltZUNvbnN0ICsgaSk7XG4gICAgICAgICAgICBzZWdtZW50LnBvaW50LnggKz0gKGNvcyAvIGRpdkNvbnN0KSAqIGVsYXN0aWNpdHk7XG4gICAgICAgICAgICBzZWdtZW50LnBvaW50LnkgKz0gKHNpbiAvIGRpdkNvbnN0KSAqIGVsYXN0aWNpdHk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjb3MsIHNpbiwgZWxhc3RpY2l0eSk7XG4gICAgICAgICAgICBlbGFzdGljaXR5IC09IDAuMDAxO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ25vIGNoaWxkcmVuIHlldCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHBhcGVyLnZpZXcub25GcmFtZSA9IGppZ2dsZTtcblxuICAgICRjYW52YXMuaGFtbWVyKClcbiAgICAgIC5vbigncGFuc3RhcnQnLCBwYW5TdGFydClcbiAgICAgIC5vbigncGFubW92ZScsIHBhbk1vdmUpXG4gICAgICAub24oJ3BhbmVuZCcsIHBhbkVuZClcbiAgICAgIC5vbigndGFwJywgdGFwKTtcblxuICAgICRjYW52YXMuZGF0YSgnaGFtbWVyJykuZ2V0KCdwYW4nKS5zZXQoeyBkaXJlY3Rpb246IEhhbW1lci5ESVJFQ1RJT05fQUxMIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gbmV3UHJlc3NlZCgpIHtcbiAgICBjb25zb2xlLmxvZygnbmV3IHByZXNzZWQnKTtcblxuICAgIHBhcGVyLnByb2plY3QuYWN0aXZlTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVuZG9QcmVzc2VkKCkge1xuICAgIGNvbnNvbGUubG9nKCd1bmRvIHByZXNzZWQnKTtcbiAgICAvLyBkMy5zZWxlY3RBbGwoJ3N2Zy5tYWluIHBhdGg6bGFzdC1jaGlsZCcpLnJlbW92ZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheVByZXNzZWQoKSB7XG4gICAgY29uc29sZS5sb2coJ3BsYXkgcHJlc3NlZCcpO1xuICB9XG5cbiAgZnVuY3Rpb24gdGlwc1ByZXNzZWQoKSB7XG4gICAgY29uc29sZS5sb2coJ3RpcHMgcHJlc3NlZCcpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hhcmVQcmVzc2VkKCkge1xuICAgIGNvbnNvbGUubG9nKCdzaGFyZSBwcmVzc2VkJyk7XG4gIH1cblxuICBmdW5jdGlvbiBpbml0TmV3KCkge1xuICAgICQoJy5tYWluLWNvbnRyb2xzIC5uZXcnKS5vbignY2xpY2sgdGFwIHRvdWNoJywgbmV3UHJlc3NlZCk7XG4gIH1cblxuICBmdW5jdGlvbiBpbml0VW5kbygpIHtcbiAgICAkKCcubWFpbi1jb250cm9scyAudW5kbycpLm9uKCdjbGljaycsIHVuZG9QcmVzc2VkKTtcbiAgfVxuICBmdW5jdGlvbiBpbml0UGxheSgpIHtcbiAgICAkKCcubWFpbi1jb250cm9scyAucGxheScpLm9uKCdjbGljaycsIHBsYXlQcmVzc2VkKTtcbiAgfVxuICBmdW5jdGlvbiBpbml0VGlwcygpIHtcbiAgICAkKCcuYXV4LWNvbnRyb2xzIC50aXBzJykub24oJ2NsaWNrJywgdGlwc1ByZXNzZWQpO1xuICB9XG4gIGZ1bmN0aW9uIGluaXRTaGFyZSgpIHtcbiAgICAkKCcuYXV4LWNvbnRyb2xzIC5zaGFyZScpLm9uKCdjbGljaycsIHNoYXJlUHJlc3NlZCk7XG4gIH1cblxuICBmdW5jdGlvbiBtYWluKCkge1xuICAgIGluaXRDb250cm9sUGFuZWwoKTtcbiAgfVxuXG4gIG1haW4oKTtcbn0pO1xuIiwiLy8gQ29udmVydHMgZnJvbSBkZWdyZWVzIHRvIHJhZGlhbnMuXG5leHBvcnQgZnVuY3Rpb24gcmFkKGRlZ3JlZXMpIHtcbiAgcmV0dXJuIGRlZ3JlZXMgKiBNYXRoLlBJIC8gMTgwO1xufTtcblxuLy8gQ29udmVydHMgZnJvbSByYWRpYW5zIHRvIGRlZ3JlZXMuXG5leHBvcnQgZnVuY3Rpb24gZGVnKHJhZGlhbnMpIHtcbiAgcmV0dXJuIHJhZGlhbnMgKiAxODAgLyBNYXRoLlBJO1xufTtcblxuXG5leHBvcnQgZnVuY3Rpb24gZGVsdGEocDEsIHAyKSB7XG4gIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3cocDEueCAtIHAyLngsIDIpICsgTWF0aC5wb3cocDEueSAtIHAyLnksIDIpKTsgLy8gcHl0aGFnb3JlYW4hXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kSW50ZXJpb3JDdXJ2ZXMocGF0aCkge1xuICBsZXQgaW50ZXJpb3JDdXJ2ZXMgPSBbXTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHBhdGguY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgY2hpbGQgPSBwYXRoLmNoaWxkcmVuW2ldO1xuXG4gICAgaWYgKCFjaGlsZC5jbG9zZWQpe1xuICAgICAgY2hpbGQucmVtb3ZlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBib3VuZHMgPSBjaGlsZC5zdHJva2VCb3VuZHM7XG4gICAgICBsZXQgaW50ZXJpb3IgPSBmYWxzZTtcblxuICAgICAgLy8gaXRlcmF0ZSB0aHJvdWdoIGFsbCBvdGhlciBjaGlsZHJlbiB0byBzZWUgaWYgdGhpcyBjaGlsZCBpcyBlbnRpcmVseSB3aXRoaW4gYW5vdGhlci4gaWYgc28sIGl0IGlzIGFuIGludGVyaW9yIHBhdGhcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcGF0aC5jaGlsZHJlbi5sZW5ndGg7IGorKykge1xuICAgICAgICAvLyBkb24ndCB0ZXN0IGFnYWluc3QgaXRzZWxmXG4gICAgICAgIGlmIChqICE9PSBpKSB7XG4gICAgICAgICAgaWYgKGNoaWxkLmlzSW5zaWRlKHBhdGguY2hpbGRyZW5bal0uc3Ryb2tlQm91bmRzKSkge1xuICAgICAgICAgICAgaW50ZXJpb3IgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoaW50ZXJpb3IpIHtcbiAgICAgICAgaW50ZXJpb3JDdXJ2ZXMucHVzaChuZXcgUGF0aChjaGlsZC5zZWdtZW50cykpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxldCBuZXdQYXRoID0gbmV3IFBhdGgoe1xuICAgIGZpbGxDb2xvcjogJ3BpbmsnLFxuICAgIHN0cm9rZUNvbG9yOiAncGluaydcbiAgfSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aC5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgIC8vIGNvbnNvbGUubG9nKHBhdGguY2hpbGRyZW5baV0pO1xuICAgIGNvbnNvbGUubG9nKG5ld1BhdGgudW5pdGUocGF0aC5jaGlsZHJlbltpXSkpO1xuICB9XG5cbiAgcGF0aC5yZW1vdmUoKTtcblxuICBjb25zb2xlLmxvZygnbmV3UGF0aCcsIG5ld1BhdGgpO1xuICBjb25zb2xlLmxvZygncGF0aCcsIHBhdGgpO1xuXG4gIGlmIChpbnRlcmlvckN1cnZlcy5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIGludGVyaW9yQ3VydmVzO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbnRlcmlvclBhdGhzKHBhdGgpIHtcbiAgLy8gbGV0IGludGVyc2VjdGlvbnMgPSBwYXRoLmdldENyb3NzaW5ncygpO1xuICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IGludGVyc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgLy8gICBsZXQgaW50ZXJzZWN0aW9uID0gaW50ZXJzZWN0aW9uc1tpXTtcbiAgLy8gICBpbnRlcnNlY3Rpb24ucGF0aC5yZXNvbHZlQ3Jvc3NpbmdzKCk7XG4gIC8vIH1cbiAgLy8gcGF0aC52aXNpYmxlID0gZmFsc2U7XG4gIC8vIGxldCBzZWNvbmRhcnlQYXRoID0gcGF0aC5jbG9uZSgpO1xuICAvLyBzZWNvbmRhcnlQYXRoLnZpc2libGUgPSBmYWxzZTtcbiAgLy8gc2Vjb25kYXJ5UGF0aC5yZXNvbHZlQ3Jvc3NpbmdzKCk7XG4gIC8vIGxldCBvbGRQYXRoID0gcGF0aDtcbiAgLy8gY29uc29sZS5sb2cob2xkUGF0aCk7XG4gIC8vIHBhdGgucmVzb2x2ZUNyb3NzaW5ncygpO1xuICAvLyBjb25zb2xlLmxvZyhwYXRoKTtcbiAgLy8gY29uc29sZS5sb2cocGF0aCA9PSBvbGRQYXRoKTtcbiAgcmV0dXJuIG51bGw7XG59XG5cbi8vIGV4cG9ydCBmdW5jdGlvbiBnZXRJbnRlcmlvclBhdGhzKHBhdGgpIHtcbi8vICAgaWYgKCFwYXRoIHx8ICFwYXRoLnNlZ21lbnRzIHx8ICEocGF0aC5zZWdtZW50cy5sZW5ndGggPiAwKSkgcmV0dXJuIG51bGw7XG4vL1xuLy8gICBsZXQgaW50ZXJzZWN0aW9ucyA9IHBhdGguZ2V0Q3Jvc3NpbmdzKCk7XG4vLyAgIC8vIGNvbnNvbGUubG9nKCdsZW5ndGgnLCBpbnRlcnNlY3Rpb25zLmxlbmd0aCk7XG4vLyAgIGlmIChpbnRlcnNlY3Rpb25zICYmIGludGVyc2VjdGlvbnMubGVuZ3RoID4gMCkge1xuLy8gICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW50ZXJzZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuLy8gICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0nKTtcbi8vICAgICAgIGxldCBpbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb25zW2ldO1xuLy8gICAgICAgbGV0IGxvY2F0aW9uID0gcGF0aC5nZXRMb2NhdGlvbk9mKGludGVyc2VjdGlvbi5wb2ludCk7XG4vLyAgICAgICBjb25zb2xlLmxvZygnbG9jYXRpb24nLCBsb2NhdGlvbi50b1N0cmluZygpKTtcbi8vICAgICAgIGxldCBpbmRleCA9IGxvY2F0aW9uLmN1cnZlLmluZGV4O1xuLy8gICAgICAgY29uc29sZS5sb2coJ2luZGV4JywgaW5kZXgudG9TdHJpbmcoKSk7XG4vLyAgICAgICBsZXQgbGFzdEFuZ2xlO1xuLy8gICAgICAgdmFyIGludGVyc2VjdGlvblBhdGg7XG4vLyAgICAgICBsZXQgaW50ZXJpb3IgPSBmYWxzZTtcbi8vICAgICAgIGNvbnNvbGUubG9nKCdwYXRoJywgcGF0aC50b1N0cmluZygpKTtcbi8vICAgICAgIGNvbnNvbGUubG9nKCdpbnRlcnNlY3Rpb24nLCBpbnRlcnNlY3Rpb24udG9TdHJpbmcoKSk7XG4vLyAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHBhdGguc2VnbWVudHMubGVuZ3RoOyBqKyspIHtcbi8vICAgICAgICAgbGV0IHBvaW50ID0gcGF0aC5zZWdtZW50c1tqXS5wb2ludDtcbi8vICAgICAgICAgbGV0IGFuZ2xlID0gaW50ZXJzZWN0aW9uLnBvaW50LmdldERpcmVjdGVkQW5nbGUocG9pbnQpO1xuLy9cbi8vICAgICAgICAgaWYgKGxhc3RBbmdsZSkge1xuLy8gICAgICAgICAgIC8vIGlnbm9yZSB0aGUgZmlyc3QgcG9pbnQsIHNpbmNlIHRoZXJlJ3Mgbm8gcHJldmlvdXMgYW5nbGUgdG8gY29tcGFyZSB0b1xuLy8gICAgICAgICAgIGlmICgoYW5nbGUgKiBsYXN0QW5nbGUpIDwgMCkge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2Nyb3NzJyk7XG4vL1xuLy8gICAgICAgICAgICAgLy8gcHJvZHVjdCBvZiBhbmdsZSBhbmQgbGFzdEFuZ2xlIHdpbGwgb25seSBiZSBuZWdhdGl2ZSBpZiBvbmUgaXMgcG9zaXRpdmUgYW5kIHRoZSBvdGhlciBpcyBuZWdhdGl2ZVxuLy8gICAgICAgICAgICAgaWYgKCFpbnRlcmlvcikge1xuLy8gICAgICAgICAgICAgICBpbnRlcmlvciA9IHRydWU7XG4vLyAgICAgICAgICAgICAgIHZhciBpbnRlcnNlY3Rpb25QYXRoID0gbmV3IFBhdGgoe1xuLy8gICAgICAgICAgICAgICAgIHN0cm9rZUNvbG9yOiB3aW5kb3cua2FuLmN1cnJlbnRDb2xvcixcbi8vICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6IHdpbmRvdy5rYW4uY3VycmVudENvbG9yXG4vLyAgICAgICAgICAgICAgIH0pO1xuLy8gICAgICAgICAgICAgICBpbnRlcnNlY3Rpb25QYXRoLmFkZChpbnRlcnNlY3Rpb24ucG9pbnQpO1xuLy8gICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgaW50ZXJpb3IgPSBmYWxzZTtcbi8vICAgICAgICAgICAgICAgLy8gaW50ZXJzZWN0aW9uUGF0aC5hZGQoaW50ZXJzZWN0aW9uLnBvaW50KTtcbi8vICAgICAgICAgICAgICAgLy8gaW50ZXJzZWN0aW9uUGF0aC5jbG9zZWQgPSBmYWxzZTtcbi8vICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uUGF0aC5zbW9vdGgoKTtcbi8vICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uUGF0aC5zZWxlY3RlZCA9IHRydWU7XG4vLyAgICAgICAgICAgICAgIC8vIGJyZWFrO1xuLy8gICAgICAgICAgICAgICAvLyBicmVhaztcbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgIH1cbi8vXG4vLyAgICAgICAgIGlmIChpbnRlcmlvcikge1xuLy8gICAgICAgICAgIGludGVyc2VjdGlvblBhdGguYWRkKHBvaW50KTtcbi8vICAgICAgICAgICBuZXcgUGF0aC5DaXJjbGUoe1xuLy8gICAgICAgICAgICAgY2VudGVyOiBwb2ludCxcbi8vICAgICAgICAgICAgIHJhZGl1czogMyxcbi8vICAgICAgICAgICAgIGZpbGxDb2xvcjogJ3BpbmsnXG4vLyAgICAgICAgICAgfSk7XG4vLyAgICAgICAgIH1cbi8vXG4vLyAgICAgICAgIGxhc3RBbmdsZSA9IGFuZ2xlO1xuLy8gICAgICAgICAvLyBpZiAoY2xvc2VzdCkge1xuLy8gICAgICAgICAvLyAgIGlmIChkaXN0YW5jZSA8IGNsb3Nlc3QpIHtcbi8vICAgICAgICAgLy8gICAgIGNsb3Nlc3QgPSBkaXN0YW5jZTtcbi8vICAgICAgICAgLy8gICB9XG4vLyAgICAgICAgIC8vICAgLy8gY29uc29sZS5sb2coZGlzdGFuY2UpO1xuLy8gICAgICAgICAvLyAgIC8vIGlmIChkaXN0YW5jZSA+IGxhc3REaXN0YW5jZSkge1xuLy8gICAgICAgICAvLyAgIC8vICAgY29uc29sZS5sb2coJ2NvbGRlcicpO1xuLy8gICAgICAgICAvLyAgIC8vIH0gZWxzZSBpZiAoZGlzdGFuY2UgPCBsYXN0RGlzdGFuY2Upe1xuLy8gICAgICAgICAvLyAgIC8vICAgY29uc29sZS5sb2coJ3dhcm1lcicpO1xuLy8gICAgICAgICAvLyAgIC8vIH0gZWxzZSB7XG4vLyAgICAgICAgIC8vICAgLy8gICBjb25zb2xlLmxvZygnc2FtZScpO1xuLy8gICAgICAgICAvLyAgIC8vIH1cbi8vICAgICAgICAgLy8gfSBlbHNlIHtcbi8vICAgICAgICAgLy8gICBjbG9zZXN0ID0gZGlzdGFuY2U7XG4vLyAgICAgICAgIC8vICAgLy8gZmlyc3QgcG9pbnQsIHN0YXJ0IG5ldyBwYXRoXG4vLyAgICAgICAgIC8vICAgLy8gbGV0IGludGVyc2VjdGlvblBhdGggPSBuZXcgUGF0aCh7XG4vLyAgICAgICAgIC8vICAgLy8gICBzdHJva2VDb2xvcjogd2luZG93Lmthbi5jdXJyZW50Q29sb3IsXG4vLyAgICAgICAgIC8vICAgLy8gICBmaWxsQ29sb3I6IHdpbmRvdy5rYW4uY3VycmVudENvbG9yXG4vLyAgICAgICAgIC8vICAgLy8gfSk7XG4vLyAgICAgICAgIC8vICAgLy8gaW50ZXJzZWN0aW9uUGF0aC5hZGQoaW50ZXJzZWN0aW9uLnBvaW50KTtcbi8vICAgICAgICAgLy9cbi8vICAgICAgICAgLy8gfVxuLy9cbi8vICAgICAgICAgLy8gbmV3IFBhdGguQ2lyY2xlKHtcbi8vICAgICAgICAgLy8gICBjZW50ZXI6IHBvaW50LFxuLy8gICAgICAgICAvLyAgIHJhZGl1czogMyxcbi8vICAgICAgICAgLy8gICBmaWxsQ29sb3I6ICdwaW5rJ1xuLy8gICAgICAgICAvLyB9KTtcbi8vICAgICAgIH1cbi8vICAgICB9XG4vLyAgIH0gZWxzZSB7XG4vLyAgICAgcmV0dXJuIG51bGw7XG4vLyAgIH1cbi8vIH1cbiJdfQ==\n"]}